# Natural Language Oracle Database Query Tool

This tool allows you to query Oracle databases using natural language. It uses OpenAI's GPT model to convert natural language queries into SQL and executes them against your Oracle database.

## Prerequisites

- Python 3.7 or higher
- Oracle Database
- OpenAI API key
- Oracle Client libraries installed

## Oracle Database Setup

This guide helps you set up Oracle Database locally using Docker, create the required tables (`departments`, `employees`), and populate them with sample data for development or testing purposes.

### Docker Setup Prerequisites

- Docker installed on your system
- PowerShell or Terminal
- SQL Developer or any Oracle SQL client (optional but recommended)

### Step 1: Pull Oracle Free Database Docker Image

```bash
docker pull container-registry.oracle.com/database/free:latest
```

> This image provides Oracle 21c Free edition.

### Step 2: Create a Docker Volume (Optional but recommended)

To persist data across restarts:

```bash
docker volume create oracle_data
```

### Step 3: Run Oracle DB Container

```bash
docker run -d --name oracle-free \
  --restart unless-stopped \
  -p 1521:1521 -p 5500:5500 \
  -e ORACLE_PWD=MySecurePassword1 \
  -e ORACLE_CHARACTERSET=AL32UTF8 \
  -v oracle_data:/opt/oracle/oradata \
  container-registry.oracle.com/database/free:latest
```

**Connection Details:**

| Parameter     | Value               |
|---------------|---------------------|
| Hostname      | `localhost`         |
| Port          | `1521`              |
| Service Name  | `FREE`              |
| Username      | `system`            |
| Password      | `MySecurePassword1` |

### Step 4: Initialize Tables and Data

1. Open SQL Developer or connect using CLI.
2. Use the script below to:
   - Drop and create `departments` and `employees` tables
   - Insert 10 departments and 20 employees

```sql
-- Drop tables if they exist
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE employees CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF;
END;
/

BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE departments CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF;
END;
/

-- Create departments table
CREATE TABLE departments (
    dept_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    dept_name VARCHAR2(100) NOT NULL,
    location VARCHAR2(100),
    PRIMARY KEY (dept_id)
);

-- Create employees table
CREATE TABLE employees (
    emp_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    name VARCHAR2(100) NOT NULL,
    position VARCHAR2(100),
    salary NUMBER(10, 2),
    dept_id NUMBER,
    PRIMARY KEY (emp_id),
    CONSTRAINT fk_dept FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
);

-- Insert sample departments
INSERT INTO departments (dept_name, location) VALUES ('HR', 'New York');
INSERT INTO departments (dept_name, location) VALUES ('Engineering', 'San Francisco');
INSERT INTO departments (dept_name, location) VALUES ('Sales', 'Chicago');
INSERT INTO departments (dept_name, location) VALUES ('Marketing', 'Los Angeles');
INSERT INTO departments (dept_name, location) VALUES ('Finance', 'Boston');
INSERT INTO departments (dept_name, location) VALUES ('IT', 'Austin');
INSERT INTO departments (dept_name, location) VALUES ('Operations', 'Denver');
INSERT INTO departments (dept_name, location) VALUES ('Support', 'Seattle');
INSERT INTO departments (dept_name, location) VALUES ('R&D', 'Houston');
INSERT INTO departments (dept_name, location) VALUES ('Legal', 'Atlanta');

-- Insert sample employees
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Alice Johnson', 'Manager', 85000, 1);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Bob Smith', 'Developer', 75000, 2);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Carol Lee', 'Analyst', 62000, 5);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('David Kim', 'Engineer', 78000, 2);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Eve Patel', 'Accountant', 69000, 5);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Frank Wang', 'Support Lead', 58000, 8);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Grace Miller', 'Recruiter', 61000, 1);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Henry Davis', 'Sales Rep', 72000, 3);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Ivy Chen', 'UX Designer', 71000, 4);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Jack Lee', 'QA Tester', 66000, 2);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Karen Gomez', 'Legal Advisor', 88000, 10);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Leo Thomas', 'HR Assistant', 54000, 1);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Maria Lopez', 'Marketing Lead', 81000, 4);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Nina Brooks', 'Engineer', 77000, 2);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Omar Khan', 'Support Agent', 55000, 8);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Paul Adams', 'IT Admin', 79000, 6);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Queenie Zhao', 'R&D Specialist', 90000, 9);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Raj Verma', 'Finance Analyst', 67000, 5);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Sara White', 'Operations Lead', 73000, 7);
INSERT INTO employees (name, position, salary, dept_id) VALUES ('Tom Carter', 'Sales Manager', 85000, 3);

COMMIT;
```

### Step 5: Test Connection

- **Hostname**: `localhost` (or LAN IP for remote connection)
- **Port**: `1521`
- **Service Name**: `FREE`
- **Username**: `system`
- **Password**: `MySecurePassword1`

Then run:
```sql
SELECT * FROM departments;
SELECT * FROM employees;
```

### Docker Tips

- Use `docker restart oracle-free` if the container was stopped
- Use `docker logs -f oracle-free` to monitor DB readiness
- Use `docker exec -it oracle-free bash` to access container shell

## Installation

1. Clone this repository
2. Install the required dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Copy the `.env.example` file to `.env`:
   ```bash
   cp .env.example .env
   ```
4. Edit the `.env` file with your credentials:
   - Add your OpenAI API key
   - Add your Oracle database connection details

## Usage

1. Run the script:
   ```bash
   python oracle_nl_query.py
   ```

2. The script includes an example query. You can modify the query in the `main()` function or create your own queries.

## Features

- Natural language to SQL conversion using OpenAI's GPT model
- Automatic schema detection
- Safe query execution
- JSON-formatted results
- Error handling and proper connection management

## Example Queries

You can use natural language queries like:
- "Show me all employees with salary greater than 50000"
- "List all departments and their employee count"
- "Find the top 5 highest paid employees"

## Sample Outputs

### Highest Paid Employees
```json
{
    "query": "Who are the top 5 highest paid employees?",
    "result": [
        {
            "name": "Queenie Zhao",
            "position": "R&D Specialist",
            "salary": 90000,
            "department": "R&D"
        },
        {
            "name": "Karen Gomez",
            "position": "Legal Advisor",
            "salary": 88000,
            "department": "Legal"
        },
        {
            "name": "Alice Johnson",
            "position": "Manager",
            "salary": 85000,
            "department": "HR"
        },
        {
            "name": "Tom Carter",
            "position": "Sales Manager",
            "salary": 85000,
            "department": "Sales"
        },
        {
            "name": "Maria Lopez",
            "position": "Marketing Lead",
            "salary": 81000,
            "department": "Marketing"
        }
    ]
}
```

### Department Salary Analysis
```json
{
    "query": "Which department has the highest average salary?",
    "result": [
        {
            "department": "R&D",
            "average_salary": 90000,
            "employee_count": 1
        },
        {
            "department": "Legal",
            "average_salary": 88000,
            "employee_count": 1
        },
        {
            "department": "Engineering",
            "average_salary": 76250,
            "employee_count": 4
        },
        {
            "department": "IT",
            "average_salary": 79000,
            "employee_count": 1
        },
        {
            "department": "Marketing",
            "average_salary": 76000,
            "employee_count": 2
        },
        {
            "department": "Sales",
            "average_salary": 78500,
            "employee_count": 2
        },
        {
            "department": "Operations",
            "average_salary": 73000,
            "employee_count": 1
        },
        {
            "department": "Finance",
            "average_salary": 66000,
            "employee_count": 3
        },
        {
            "department": "HR",
            "average_salary": 66667,
            "employee_count": 3
        },
        {
            "department": "Support",
            "average_salary": 56500,
            "employee_count": 2
        }
    ]
}
```

## Security Notes

- Never commit your `.env` file with real credentials
- The script uses parameterized queries to prevent SQL injection
- OpenAI API key should be kept secure and not shared
- A `.gitignore` file is included to prevent accidental commits of sensitive files

## Project Structure

```
.
├── oracle_nl_query.py    # Main script
├── requirements.txt      # Python dependencies
├── .env.example         # Example environment variables
├── .env                 # Your environment variables (not tracked in git)
└── .gitignore          # Git ignore rules
```

## Error Handling

The script includes comprehensive error handling for:
- Database connection issues
- Query conversion errors
- SQL execution errors
- API communication problems

## Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

> Note: The Oracle Database Free setup is intended for development and educational purposes. Oracle Database Free is subject to [Oracle's licensing terms](https://www.oracle.com/downloads/licenses/oracle-free-license.html). 